<!doctype html>
<html lang="ko">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KB국민카드 | 추가 서류 제출 (0033)</title>

  <style>
    :root {
      --text: #333;
      --muted: #666;
      --line: #e4e4e4;
      --req: #e50000;
      --kb-yellow: #ffcc00;
      --kb-yellow-dark: #eebf00;
      --white: #fff;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Pretendard", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      color: var(--text);
      background: var(--white);
      line-height: 1.5;
    }

    /* Wrap */
    .wrap {
      max-width: 1000px;
      margin: 0 auto;
      padding: 50px 20px 100px;
    }

    /* Page Title */
    .page-title {
      font-size: 26px;
      font-weight: 800;
      margin: 0 0 20px 0;
      color: #111;
    }

    /* Form Table */
    .form-container {
      border-top: 2px solid #222;
      border-bottom: 1px solid var(--line);
      display: flex;
    }

    .form-label-col {
      width: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
      font-weight: 700;
      color: #111;
    }

    .form-label-col .star {
      color: var(--req);
      margin-left: 6px;
    }

    .form-content-col {
      flex: 1;
      border-left: 1px solid var(--line);
    }

    .doc-row {
      display: flex;
      align-items: center;
      padding: 12px 20px;
      border-bottom: 1px solid var(--line);
    }

    .doc-row:last-child {
      border-bottom: none;
    }

    .doc-name {
      width: 240px;
      font-size: 14px;
      color: #555;
      line-height: 1.4;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .info-icon {
      width: 18px;
      height: 18px;
      border-radius: 9px;
      background: #8894a0;
      color: #fff;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
    }

    .file-display {
      flex: 1;
      height: 42px;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 0 16px;
      font-size: 14px;
      color: #333;
      background: #fff;
      outline: none;
      margin-right: 12px;
    }

    .file-display::placeholder {
      color: #999;
    }

    .file-display.is-invalid {
      border-color: var(--req);
      background: #fff9f9;
    }

    .btn-browse {
      width: 90px;
      height: 42px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: #f8f9fa;
      color: #444;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: .15s ease;
      flex-shrink: 0;
    }

    .btn-browse:hover {
      background: #eee;
    }

    .btn-browse:active {
      background: #e4e4e4;
    }

    /* Buttons */
    .btn-area {
      margin-top: 50px;
      display: flex;
      justify-content: center;
      gap: 12px;
    }

    .btn-secondary {
      width: 180px;
      height: 52px;
      border-radius: 4px;
      border: 1px solid #999;
      background: #fff;
      color: #333;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: .15s ease;
    }

    .btn-secondary:hover {
      background: #fafafa;
    }

    .btn-primary {
      width: 180px;
      height: 52px;
      border: none;
      border-radius: 4px;
      background: var(--kb-yellow);
      color: #222;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: .15s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .btn-primary:hover {
      background: var(--kb-yellow-dark);
    }

    .btn-primary:disabled {
      background: #eee;
      color: #aaa;
      cursor: not-allowed;
    }

    .spinner {
      width: 18px;
      height: 18px;
      border: 3px solid rgba(0, 0, 0, 0.12);
      border-top-color: #333;
      border-radius: 50%;
      animation: spin .8s linear infinite;
      display: none;
    }

    .btn-primary.is-loading .spinner {
      display: block;
    }

    .btn-primary.is-loading .btn-text {
      display: none;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Toast */
    .toast {
      position: fixed;
      left: 50%;
      bottom: 40px;
      transform: translateX(-50%) translateY(20px);
      background: rgba(33, 33, 33, .92);
      color: #fff;
      padding: 12px 22px;
      border-radius: 30px;
      font-size: 14px;
      font-weight: 600;
      opacity: 0;
      pointer-events: none;
      transition: all .28s cubic-bezier(.175, .885, .32, 1.275);
      z-index: 3000;
      max-width: calc(100vw - 40px);
      text-align: center;
      line-height: 1.35;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    @media (max-width: 768px) {
      .form-container {
        flex-direction: column;
      }
      .form-label-col {
        width: 100%;
        padding: 20px;
        border-right: none;
        border-bottom: 1px solid var(--line);
      }
      .form-content-col {
        border-left: none;
      }
      .doc-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      .doc-name {
        width: 100%;
      }
      .file-control {
        width: 100%;
        display: flex;
      }
      .file-display {
        flex: 1;
        width: auto;
      }
    }

    /* Flex wrapper for file control to support responsive layout */
    .file-control {
      display: flex;
      flex: 1;
      width: 100%;
    }
  </style>

  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css" />
  <link rel="stylesheet" href="css/kb-theme.css" />
  <link rel="stylesheet" href="css/common.css" />
</head>

<body>

  <div class="wrap">
    <h1 class="page-title">추가 서류 제출</h1>

    <div class="form-container">
      <div class="form-label-col">
        서류제출 첨부 <span class="star" aria-hidden="true">*</span>
      </div>

      <div class="form-content-col" id="doc-list">
        <!-- JS 렌더 -->
      </div>
    </div>

    <div class="btn-area">
      <button type="button" id="btn-edit" class="btn-secondary">수정하기</button>
      <button type="button" id="btn-next" class="btn-primary" disabled>
        <span class="spinner" aria-hidden="true"></span>
        <span class="btn-text">다음</span>
      </button>
    </div>
  </div>

  <!-- 토스트 -->
  <div id="toast" class="toast" aria-live="polite"></div>

  <script>
    (function () {
      const META = {
        id: "0033",
        editTarget: "0020",
        nextTarget: "0034"
      };

      const ALLOWED_EXT = new Set(["jpg", "jpeg", "png", "pdf"]);
      const ACCEPT = "image/jpeg,image/png,application/pdf";

      const DOCS = [
        { key: "biz_cert", name: "사업자등록증 사본 또는<br>사업자등록증명원 (필수)", required: true },
        { key: "corp_reg", name: "법인등기사항전부증명서 (필수)", required: true },
        { key: "holders", name: "주주명부 및 (정관) (필수)", required: true, info: "정관 포함 제출(정책 기준에 따라 변경 가능)" },
        { key: "id_card", name: "신청인신분증 (필수)", required: true },
        { key: "fs_std", name: "표준재무제표증명", required: false },
        { key: "vat_std", name: "부가세과세표준증명원", required: false },
        { key: "etc_1", name: "기타", required: false },
        { key: "etc_2", name: "기타", required: false }
      ];

      const toast = document.getElementById("toast");
      const docListEl = document.getElementById("doc-list");
      const btnEdit = document.getElementById("btn-edit");
      const btnNext = document.getElementById("btn-next");

      const state = Object.fromEntries(DOCS.map(d => [d.key, { file: null, valid: false }]));

      const showToast = (message) => {
        toast.textContent = message;
        toast.classList.add("show");
        setTimeout(() => toast.classList.remove("show"), 2500);
      };

      const setLoading = (isLoading) => {
        btnNext.disabled = isLoading || !canProceed();
        btnNext.classList.toggle("is-loading", isLoading);
      };

      const getExt = (filename) => {
        const idx = filename.lastIndexOf(".");
        if (idx === -1) return "";
        return filename.slice(idx + 1).toLowerCase();
      };

      const validateFile = (file) => {
        if (!file) return { ok: false, msg: "파일이 선택되지 않았습니다." };
        const ext = getExt(file.name);
        if (!ALLOWED_EXT.has(ext)) {
          return { ok: false, msg: "JPG, JPEG, PNG, PDF만 업로드 가능합니다." };
        }
        return { ok: true, msg: "" };
      };

      const canProceed = () => {
        for (const d of DOCS) {
          if (!d.required) continue;
          if (!state[d.key].file || !state[d.key].valid) return false;
        }
        return true;
      };

      const updateNextState = () => {
        if (btnNext.classList.contains("is-loading")) return;
        btnNext.disabled = !canProceed();
      };

      const markFirstMissing = () => {
        const first = DOCS.find(d => d.required && (!state[d.key].file || !state[d.key].valid));
        if (!first) return;

        const row = docListEl.querySelector(`[data-key="${first.key}"]`);
        const display = row ? row.querySelector(".file-display") : null;
        if (display) display.classList.add("is-invalid");
      };

      // Render
      const render = () => {
        docListEl.innerHTML = "";

        DOCS.forEach((d) => {
          const row = document.createElement("div");
          row.className = "doc-row";
          row.dataset.key = d.key;

          const name = document.createElement("div");
          name.className = "doc-name";
          name.innerHTML = `<span>${d.name}</span>`;

          if (d.info) {
            const info = document.createElement("span");
            info.className = "info-icon";
            info.textContent = "?";
            info.title = d.info;
            info.addEventListener("click", () => showToast(d.info));
            name.appendChild(info);
          }

          const fileControl = document.createElement("div");
          fileControl.className = "file-control";

          const display = document.createElement("input");
          display.type = "text";
          display.className = "file-display";
          display.placeholder = "JPG, JPEG, PNG, PDF만 업로드 가능";
          display.readOnly = true;

          const browse = document.createElement("button");
          browse.type = "button";
          browse.className = "btn-browse";
          browse.textContent = "찾아보기";

          const file = document.createElement("input");
          file.type = "file";
          file.accept = ACCEPT;
          file.style.display = "none";

          browse.addEventListener("click", () => file.click());

          file.addEventListener("change", () => {
            const f = (file.files && file.files[0]) ? file.files[0] : null;
            const { ok, msg } = validateFile(f);

            if (!f) {
              state[d.key] = { file: null, valid: false };
              display.value = "";
              display.classList.remove("is-invalid");
              updateNextState();
              return;
            }

            display.value = f.name;

            if (!ok) {
              state[d.key] = { file: f, valid: false };
              display.classList.add("is-invalid");
              showToast(msg);
              updateNextState();
              return;
            }

            state[d.key] = { file: f, valid: true };
            display.classList.remove("is-invalid");
            updateNextState();
          });

          fileControl.appendChild(display);
          fileControl.appendChild(browse);

          row.appendChild(name);
          row.appendChild(fileControl);
          row.appendChild(file);

          docListEl.appendChild(row);
        });

        updateNextState();
      };

      const goTo = (id) => { location.hash = `#/${id}`; };

      btnEdit.addEventListener("click", () => {
        showToast("수정하기 버튼 클릭됨");
        if (window.ScenarioNav) {
          ScenarioNav.goNext();
        } else {
          setTimeout(() => goTo(META.editTarget), 250);
        }
      });

      btnNext.addEventListener("click", async () => {
        if (btnNext.classList.contains("is-loading")) return;

        if (!canProceed()) {
          showToast("필수 서류를 모두 업로드해 주세요.");
          markFirstMissing();
          return;
        }

        setLoading(true);
        showToast("서류 확인 중입니다...");

        try {
          await new Promise(res => setTimeout(res, 700));
          showToast("업로드 완료. 다음 단계로 이동합니다.");
          if (window.ScenarioNav) {
            ScenarioNav.goNext();
          } else {
            setTimeout(() => goTo(META.nextTarget), 600);
          }
        } finally {
          setLoading(false);
        }
      });

      render();
    })();
  </script>
</body>
</html>